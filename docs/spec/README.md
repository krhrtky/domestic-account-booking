# 機能仕様書

家計精算アプリ（Household Settlement）の機能仕様を定義する。

## 概要

本ドキュメント群は、Laws（開発ルール）に準拠した機能仕様を定義する。
実装・テスト・レビュー時の判断基準として使用する。

## 仕様の優先順位

```
Laws > 実装（動作しているコード） > ドキュメント（本仕様書）
```

## 機能一覧

| 機能 | 仕様書 | 主要Laws | 概要 |
|------|--------|----------|------|
| 精算 | [settlement.md](./settlement.md) | L-BR-001, L-CX-001, L-OC-002 | 月次精算金額の算出 |
| 取引管理 | [transaction.md](./transaction.md) | L-BR-003, L-BR-006, L-SC-002 | CSV取り込み、分類、削除 |
| グループ管理 | [group.md](./group.md) | L-BR-005, L-SC-001 | グループ作成、招待、割合設定 |
| 認証 | [auth.md](./auth.md) | L-SC-001, L-SC-004, L-SC-005 | サインアップ、ログイン、ログアウト |

## 機能間の関係

```
┌─────────────────────────────────────────────────────────────┐
│                        認証 (auth)                          │
│  サインアップ → ログイン → セッション管理                     │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    グループ管理 (group)                      │
│  グループ作成 → パートナー招待 → 負担割合設定                 │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    取引管理 (transaction)                    │
│  CSV取り込み / 手動入力 → 分類変更 → 削除                    │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                       精算 (settlement)                      │
│  月次集計 → 精算計算 → 結果表示 → 根拠確認                   │
└─────────────────────────────────────────────────────────────┘
```

## Laws との対応表

### 業務ルール (L-BR)

| Law ID | 関連機能 | 仕様書の対応セクション |
|--------|----------|----------------------|
| L-BR-001 | 精算 | [settlement.md#計算ロジック](./settlement.md#計算ロジック) |
| L-BR-002 | 精算 | [settlement.md#支払元payerの影響l-br-002](./settlement.md#支払元payerの影響l-br-002) |
| L-BR-003 | 取引管理 | [transaction.md#支出タイプexpensetypeの定義l-br-003](./transaction.md#支出タイプexpensetypeの定義l-br-003) |
| L-BR-005 | グループ管理 | [group.md#制約バリデーション](./group.md#制約バリデーション) |
| L-BR-006 | 取引管理 | [transaction.md#csv取り込み仕様l-br-006](./transaction.md#csv取り込み仕様l-br-006) |
| L-BR-007 | 精算 | [settlement.md#uc-s02-精算根拠の確認l-br-007](./settlement.md#uc-s02-精算根拠の確認l-br-007) |

### 顧客体験 (L-CX)

| Law ID | 関連機能 | 仕様書の対応セクション |
|--------|----------|----------------------|
| L-CX-001 | 精算 | [settlement.md#計算ロジック](./settlement.md#計算ロジック) |
| L-CX-003 | 認証 | [auth.md#エラー処理](./auth.md#エラー処理) |
| L-CX-004 | 認証 | [auth.md#ローディング状態l-cx-004](./auth.md#ローディング状態l-cx-004) |

### セキュリティ (L-SC)

| Law ID | 関連機能 | 仕様書の対応セクション |
|--------|----------|----------------------|
| L-SC-001 | 認証, グループ | [auth.md#認可マトリクスl-sc-001](./auth.md#認可マトリクスl-sc-001) |
| L-SC-002 | 取引管理 | [transaction.md#セキュリティ対策](./transaction.md#セキュリティ対策) |
| L-SC-003 | 認証 | [auth.md#パスワード要件l-sc-003](./auth.md#パスワード要件l-sc-003) |
| L-SC-004 | 認証 | [auth.md#レート制限l-sc-004](./auth.md#レート制限l-sc-004) |
| L-SC-005 | 認証 | [auth.md#セッション管理l-sc-005](./auth.md#セッション管理l-sc-005) |

### 組織の一貫性 (L-OC)

| Law ID | 関連機能 | 仕様書の対応セクション |
|--------|----------|----------------------|
| L-OC-002 | 精算 | [settlement.md#実装場所](./settlement.md#実装場所) |

## 仕様書フォーマット

各機能仕様書は以下のセクションで構成される：

1. **概要**: 機能の目的と範囲
2. **関連Laws**: 準拠すべきルール一覧
3. **ユースケース**: ユーザーシナリオ
4. **入出力仕様**: データ型と形式
5. **制約・バリデーション**: 業務制約とバリデーションルール
6. **エラー処理**: エラー条件とメッセージ
7. **実装場所**: 正規実装ファイル
8. **テスト観点**: テストケース一覧

## 変更履歴

| 日付 | 変更内容 |
|------|---------|
| 2025-12-14 | 初版作成（精算、取引管理、グループ管理、認証） |

## 関連ドキュメント

- [Laws（開発ルール）](../laws/README.md)
- [REQUIREMENTS.md](../../REQUIREMENTS.md)
- [SPEC.md](../../SPEC.md)
