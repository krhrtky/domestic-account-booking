# Test File Rules

This rule applies to all test files (`**/*.test.*`, `**/*.spec.*`).

## Applicable Laws

Reference: [docs/laws/07-test-audit.md](../../docs/laws/07-test-audit.md)

### L-TA-001: Evaluation Dataset Categories

Tests must cover these categories:

| Category | Purpose | Min Count |
|----------|---------|-----------|
| Typical | Normal happy path | 3+ |
| Boundary | Edge cases, limits | 3+ |
| Incident | Past bug reproductions | 1+ |
| Gray | Ambiguous inputs | 1+ |
| Attack | Security test patterns | 3+ |

### L-TA-002: Scoring Rubric

#### Pass Criteria
| Metric | Threshold |
|--------|-----------|
| All unit tests | PASS |
| All integration tests | PASS |
| Code coverage | 80%+ |
| Critical path coverage | 100% |
| Security tests | All PASS |

### L-TA-005: Dataset Requirements Verification

Verify test datasets meet requirements:
```typescript
const DatasetSchema = z.object({
  typical: z.array(TypicalCaseSchema).min(3),
  boundary: z.array(BoundaryCaseSchema).min(3),
  incident: z.array(IncidentCaseSchema).min(1),
  gray: z.array(GrayCaseSchema).min(1),
  attack: z.array(AttackCaseSchema).min(3),
});
```

### Test Naming Convention

```typescript
describe('L-XX-NNN: Rule Name', () => {
  describe('Category', () => {
    it('specific behavior', () => {
      // test
    });
  });
});
```

### L-TA-003: Red Team Scenarios

Security tests must include:

**Authentication:**
- Expired/forged session tokens
- Brute force login attempts
- Session fixation attacks

**Injection:**
- SQL injection in search
- XSS in user input display
- CSV formula injection

**Data Leakage:**
- Cross-group data access
- Verbose error messages
- Log file sensitive data

### Coverage Requirements

| Area | Target |
|------|--------|
| src/lib/settlement.ts | 100% |
| src/lib/errors.ts | 100% |
| API routes | 80%+ |
| Components | 70%+ |
